name: Docs Validation

on:
  pull_request:
    branches: [ dev, main ]  # ç›‘æ§çš„åˆ†æ”¯åç§°
    paths:
      - 'docs/**'        # ä»…å½“ docs ç›®å½•å˜æ›´æ—¶è§¦å‘
      - 'scripts/**'  # ä»…å½“ scripts ç›®å½•å˜æ›´æ—¶è§¦å‘
      - '.github/workflows/docs-validation.yml'  # ä»…å½“å·¥ä½œæµæ–‡ä»¶å˜æ›´æ—¶è§¦å‘

jobs:
  validate-docs:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '22'

    - name: Install dependencies
      run: npm install js-yaml@4 chalk@4

    - name: Run validation
      id: validation
      run: |
        node scripts/validate-docs.cjs 2>&1 | tee validation.log
        echo "VALIDATION_RESULT<<EOF" >> $GITHUB_ENV
        cat validation.log >> $GITHUB_ENV
        echo "EOF" >> $GITHUB_ENV

    - name: Create PR comment
      if: ${{ failure() }}
      uses: actions/github-script@v7
      with:
        script: |
          const output = process.env.VALIDATION_RESULT;
          const comment = `### æ–‡æ¡£è§„èŒƒæ£€æŸ¥ç»“æœ ğŸ”\n\n\`\`\`\n${output}\n\`\`\``;
          
          await github.rest.issues.createComment({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: context.payload.pull_request.number,
            body: comment
          });
